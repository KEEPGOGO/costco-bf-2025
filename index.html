<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Costco é»‘è‰²æ˜ŸæœŸäº”ç‰¹åƒ¹æŸ¥è©¢</title>
    <style>
        :root {
            --primary: #005eb8; /* Costco Blue */
            --accent: #e31837; /* Costco Red */
            --bg: #f4f4f4;
            --text-color: #333;
            /* æ–°å¢æŠ˜æ‰£èƒŒæ™¯é¡è‰²ï¼Œèˆ‡åŸé¢¨æ ¼çš„ discount-badge åŒ¹é… */
            --discount-bg: rgba(227, 24, 55, 0.1); 
        }
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: var(--text-color);
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
        }

        /* --- æ—¥æœŸé ç±¤æ¨£å¼ --- */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            overflow-x: auto; /* æ‰‹æ©Ÿç‰ˆå¯æ©«æ»‘ */
            white-space: nowrap;
        }
        .tab-btn {
            padding: 10px 20px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            border-radius: 20px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
        }
        .tab-btn:hover {
            background: #eef;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,94,184,0.3);
        }
        /* ------------------------ */

        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #eee;
            border-radius: 8px;
            align-items: center;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-size: 12px;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }
        select, input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        /* Product Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }
        .category-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #666;
            color: white;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
        }
        .card h3 {
            margin: 25px 0 10px 0;
            font-size: 16px;
            color: #333;
            height: 44px;
            overflow: hidden;
            line-height: 1.4;
        }
        .model-code {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-top: 10px;
        }
        .original {
            text-decoration: line-through;
            color: #999;
            font-size: 14px;
        }
        .sale-price {
            font-size: 22px;
            font-weight: bold;
            color: var(--accent);
        }
        .discount-badge {
            background: rgba(227, 24, 55, 0.1);
            color: var(--accent);
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            border: 1px dashed var(--accent);
        }
        .cp-tag {
            display: block;
            font-size: 12px;
            color: #d32f2f;
            text-align: center;
            margin-top: 4px;
        }
        
        /* ç©ºç‹€æ…‹æ¨£å¼ */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px;
            color: #999;
            background: #f9f9f9;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }
        .empty-state h2 { font-size: 24px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ›’ Costco 2025 é»‘äº”ç‰¹åƒ¹æƒ…å ±</h1>

    <div class="tabs" id="dayTabs">
        </div>

    <div class="controls">
        <div class="control-group">
            <label>ğŸ” æœå°‹å•†å“</label>
            <input type="text" id="searchInput" placeholder="è¼¸å…¥é›»è¦–ã€æ´—è¡£æ©Ÿ...">
        </div>

        <div class="control-group">
            <label>ğŸ“‚ åˆ†é¡ç¯©é¸</label>
            <select id="categorySelect">
                <option value="all">å…¨éƒ¨é¡¯ç¤º</option>
                <option value="å¤§å‹å®¶é›»">ğŸ  å¤§å‹å®¶é›»</option>
                <option value="å»šæˆ¿å°å®¶é›»">ğŸ½ å»šæˆ¿å°å®¶é›»</option>
                <option value="å±…å®¶æ¸…æ½”/è­·ç†å®¶é›»">ğŸ§¼ å±…å®¶æ¸…æ½”/è­·ç†å®¶é›»</option>
                <option value="é›»è…¦/é€±é‚Š">ğŸ’» é›»è…¦/é€±é‚Š</option>
                <option value="æ‰‹æ©Ÿ/å½±éŸ³é…ä»¶">ğŸ§ æ‰‹æ©Ÿ/å½±éŸ³é…ä»¶</option>
                <option value="æœé£¾/é‹é¡">ğŸ‘— æœé£¾/é‹é¡</option>
                <option value="å€‹äººæ¸…æ½”/ç¾å¦">ğŸ§´ å€‹äººæ¸…æ½”/ç¾å¦</option>
                <option value="å‚¢ä¿±/å¯¢å…·">ğŸ›ï¸ å‚¢ä¿±/å¯¢å…·</option>
                <option value="å±…å®¶ç”Ÿæ´»/è£é£¾">ğŸ–¼ï¸ å±…å®¶ç”Ÿæ´»/è£é£¾</option>
                <option value="æˆ¶å¤–/é‹å‹•/ä¼‘é–’">ğŸ€ æˆ¶å¤–/é‹å‹•/ä¼‘é–’</option>
                <option value="ç”Ÿé®®/å†·å‡é£Ÿå“">ğŸ¥© ç”Ÿé®®/å†·å‡é£Ÿå“</option>
                <option value="çƒ˜ç„™/é›¶é£Ÿ/é£²å“">ğŸ« çƒ˜ç„™/é›¶é£Ÿ/é£²å“</option>
                <option value="ä¿å¥é£Ÿå“">ğŸ’Š ä¿å¥é£Ÿå“</option>
                <option value="å¬°å¹¼å…’ç”¨å“">ğŸ§¸ å¬°å¹¼å…’ç”¨å“</option>
                <option value="å¯µç‰©ç”¨å“">ğŸ¾ å¯µç‰©ç”¨å“</option>
                </select>
        </div>

        <div class="control-group">
            <label>ğŸ“Š æ’åºæ–¹å¼</label>
            <select id="sortSelect">
                <option value="day_asc">æ—¥æœŸæ–°åˆ°èˆŠ</option>
                <option value="discount_desc">ğŸ’° æŠ˜æ‰£é‡‘é¡ (é«˜ â†’ ä½)</option>
                <option value="percent_desc">ğŸ“‰ æŠ˜æ‰£å¹…åº¦ % (å¤§ â†’ å°)</option>
                <option value="price_asc">ğŸ’² å”®åƒ¹ (ä½ â†’ é«˜)</option>
            </select>
        </div>
    </div>

    <div id="productGrid" class="grid">
        <div class="empty-state">
            <h2>â³ æ­£åœ¨è¼‰å…¥æ•¸æ“š...</h2>
            <p>è«‹ç¨å€™ç‰‡åˆ»ï¼Œæˆ–æª¢æŸ¥ data.json æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚</p>
        </div>
    </div>
</div>

<script>
    // ğŸš¨ æ•¸æ“šåˆ†é›¢ï¼šrawData è®Šæ•¸å·²ç§»é™¤
    // 1. é è¨­é¡¯ç¤ºå…¨éƒ¨ ('all')
    let currentDay = 'all'; 
    let allProductsData = []; 

    const dayTabs = document.getElementById('dayTabs');
    const grid = document.getElementById('productGrid');
    const searchInput = document.getElementById('searchInput');
    const categorySelect = document.getElementById('categorySelect');
    const sortSelect = document.getElementById('sortSelect');
    
    // Day/Date Mapping
    const dayLabels = {
        1: 'Day 1 (11/24)',
        2: 'Day 2 (11/25)',
        3: 'Day 3 (11/26)',
        4: 'Day 4 (11/27)',
        5: 'Day 5 (11/28)',
        6: 'Day 6 (11/29)',
        7: 'Day 7 (11/30)',
        'all': 'é¡¯ç¤ºå…¨éƒ¨'
    };

    // --- æ ¸å¿ƒå‡½æ•¸ ---

    /**
     * æ¸²æŸ“å•†å“å¡ç‰‡åˆ°ç¶²æ ¼ä¸­
     * @param {Array} items - ç¶“éç¯©é¸å’Œæ’åºçš„å•†å“åˆ—è¡¨
     */
    function render(items) {
        grid.innerHTML = '';

        if (items.length === 0) {
            let msg = `åœ¨ç•¶å‰æ¢ä»¶ä¸‹æ‰¾ä¸åˆ°å•†å“ã€‚`;
            if(allProductsData.length === 0) {
                msg = "ç›®å‰æ²’æœ‰ä»»ä½•è³‡æ–™ï¼Œè«‹åŸ·è¡Œ merge.py æ›´æ–°æ•¸æ“šä¸¦ç¢ºä¿ data.json å­˜åœ¨ã€‚";
            }
            
            grid.innerHTML = `
                <div class="empty-state">
                    <h2>ğŸš§ å°šç„¡è³‡æ–™</h2>
                    <p>${msg}</p>
                </div>
            `;
            return;
        }

        items.forEach(item => {
            // 1. åƒ¹æ ¼è¨ˆç®—
            const priceDisplay = item.sale > 0 ? `$${item.sale.toLocaleString()}` : "ä¾é‡é‡";
            const originalDisplay = item.original > 0 ? `$${item.original.toLocaleString()}` : "---";
            
            // 2. æŠ˜æ‰£é¡¯ç¤ºé‚è¼¯ (ä¿®æ­£ï¼šä½¿ç”¨ Math.abs è™•ç†è² æ•¸ discount)
            const absoluteDiscount = Math.abs(item.discount || 0); // å–çµ•å°å€¼
            const discountDisplay = absoluteDiscount > 0 ? 
                `çœ $${absoluteDiscount.toLocaleString()}` : 
                "ç¾å ´ç‰¹åƒ¹";
            
            // 3. æŠ˜æ‰£ç™¾åˆ†æ¯”è¨ˆç®—
            let percentText = "";
            let percent = 0;
            if(item.original > 0 && absoluteDiscount > 0) {
                percent = Math.round((absoluteDiscount / item.original) * 100);
                // é¡¯ç¤ºæŠ˜æ•¸å’Œç™¾åˆ†æ¯”
                percentText = `ç´„ ${((100 - percent) / 10).toFixed(1).replace('.0', '')} æŠ˜ (-${percent}%)`;
            } else {
                // å¦‚æœæ²’æœ‰æŠ˜æ‰£ï¼Œé¡¯ç¤ºå‚™è¨»æˆ–ç‰¹æ®Šåƒ¹æ ¼
                percentText = item.note || "å°ˆæ¡ˆæ´»å‹•åƒ¹";
            }
            
            // 4. åœ–ç‰‡é ç•™å€ (å‡è¨­åœ–ç‰‡æª”åç‚º model.jpg)
            const imagePath = item.model ? `images/${item.model}.jpg` : 'images/placeholder.jpg';
            
            const modelDisplay = item.model ? item.model.replace('ITEM #', '') : '';

            const card = document.createElement('div');
            card.className = 'card';
            
            card.innerHTML = `
                <span class="category-tag">${item.catName || item.category}</span>
                <h3>${item.name}</h3>
                <div class="model-code">å‹è™Ÿ: ${modelDisplay}</div>
                <div class="original">åŸåƒ¹: ${originalDisplay}</div>
                <div class="price-row">
                    <div class="sale-price">${priceDisplay}</div>
                </div>
                <div class="discount-badge">
                    ${discountDisplay}
                </div>
                <span class="cp-tag">${percentText}</span>
            `;
            grid.appendChild(card);
        });
    }

    /**
     * åŸ·è¡Œæ‰€æœ‰ç¯©é¸å’Œæ’åºé‚è¼¯
     */
    function filterAndSort() {
        if (allProductsData.length === 0) {
            render([]);
            return;
        }

        let result = [...allProductsData];

        // 0. æ—¥æœŸ Filter
        if (currentDay !== 'all') {
            result = result.filter(p => p.day === currentDay);
        }

        // 1. æœå°‹ Filter
        const keyword = searchInput.value.toLowerCase();
        if (keyword) {
            result = result.filter(p => 
                p.name.toLowerCase().includes(keyword) || 
                (p.model && p.model.toLowerCase().includes(keyword))
            );
        }

        // 2. åˆ†é¡ Filter (***æ­¤è™•ç‚ºé—œéµæ”¹å‹•***: ç¯©é¸ catName è€Œé category)
        const catNameSelected = categorySelect.value;
        if (catNameSelected !== 'all') {
            // ç¯©é¸æ™‚æª¢æŸ¥å•†å“çš„ catName æ˜¯å¦èˆ‡é¸ä¸­çš„åˆ†é¡åç¨±ä¸€è‡´
            result = result.filter(p => p.catName === catNameSelected);
        }

        // 3. æ’åº Sort
        const sortType = sortSelect.value;
        if (sortType === 'discount_desc') {
            // æ’åºæ™‚ä½¿ç”¨çµ•å°å€¼
            result.sort((a, b) => Math.abs(b.discount || 0) - Math.abs(a.discount || 0));
        } else if (sortType === 'price_asc') {
            result.sort((a, b) => {
                if(a.sale === 0) return 1;
                return a.sale - b.sale;
            });
        } else if (sortType === 'percent_desc') {
            result.sort((a, b) => {
                const discA = Math.abs(a.discount || 0);
                const discB = Math.abs(b.discount || 0);
                const perA = a.original > 0 ? (discA / a.original) : 0;
                const perB = b.original > 0 ? (discB / b.original) : 0;
                return perB - perA;
            });
        } else if (sortType === 'day_asc') {
             // ç¢ºä¿ Day 1 å„ªå…ˆï¼ŒDay 7 æœ€å¾Œ
             result.sort((a, b) => a.day - b.day);
        }


        render(result);
    }

    /**
     * è¨­ç½®ç•¶å‰é¡¯ç¤ºçš„å¤©æ•¸ï¼Œä¸¦è§¸ç™¼ç¯©é¸
     */
    function setDay(day) {
        currentDay = day;
        
        // æ›´æ–°æŒ‰éˆ•æ¨£å¼ (é‡æ–°æŸ¥è©¢æ‰€æœ‰ tab-btn)
        const allTabBtns = document.querySelectorAll('.tab-btn');
        allTabBtns.forEach(btn => {
            btn.classList.remove('active');
        });
        
        // ç¢ºä¿é¸ä¸­çš„æŒ‰éˆ•è¢«æ¿€æ´»
        const dayKey = (day === 'all') ? 'all' : day;
        const activeBtn = document.getElementById(`day-tab-${dayKey}`);
        if (activeBtn) {
            activeBtn.classList.add('active');
        }

        filterAndSort();
    }

    /**
     * å‹•æ…‹å‰µå»º Day Tabs (åŒ…å«æ—¥æœŸæ¨™ç±¤)
     */
    function createDayTabs() {
        const maxDay = allProductsData.reduce((max, p) => Math.max(max, p.day || 0), 0);
        dayTabs.innerHTML = ''; // æ¸…ç©ºèˆŠçš„æŒ‰éˆ•
        
        // 1. æ–°å¢ã€Œé¡¯ç¤ºå…¨éƒ¨ã€æŒ‰éˆ• (æ”¾åœ¨æœ€å‰é¢)
        const allButton = document.createElement('button');
        allButton.className = 'tab-btn';
        allButton.id = 'day-tab-all';
        allButton.textContent = dayLabels['all'];
        allButton.onclick = () => setDay('all');
        dayTabs.appendChild(allButton);

        // 2. æ–°å¢ Day 1 åˆ° MaxDay æŒ‰éˆ•
        for (let i = 1; i <= maxDay; i++) {
            const button = document.createElement('button');
            button.className = 'tab-btn';
            button.id = `day-tab-${i}`;
            // ç¢ºä¿é¡¯ç¤º Day X (æ—¥æœŸ)
            button.textContent = dayLabels[i] || `Day ${i}`; 
            button.onclick = () => setDay(i);
            dayTabs.appendChild(button);
        }
        
        // é è¨­é¸ä¸­ã€Œé¡¯ç¤ºå…¨éƒ¨ã€
        if (allProductsData.length > 0) {
            setDay('all');
        } else {
            render([]); // å¦‚æœæ²’æœ‰æ•¸æ“šï¼Œé¡¯ç¤ºç©ºç‹€æ…‹
        }
    }

    /**
     * ç•°æ­¥è¼‰å…¥æ•¸æ“š (æ•¸æ“šåˆ†é›¢çš„æ ¸å¿ƒ)
     */
    async function loadData() {
        grid.innerHTML = `<div class="empty-state"><h2>â³ æ­£åœ¨è¼‰å…¥æ•¸æ“š...</h2><p>è«‹ç¨å€™ç‰‡åˆ»ï¼Œæˆ–æª¢æŸ¥ data.json æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚</p></div>`;

        try {
            const response = await fetch('data.json'); 
            if (!response.ok) {
                throw new Error(`ç„¡æ³•è¼‰å…¥ data.json. ç‹€æ…‹: ${response.status}`);
            }
            const rawData = await response.json();
            
            // å°‡è¼‰å…¥çš„æ•¸æ“šè³¦äºˆå…¨åŸŸè®Šæ•¸
            allProductsData = rawData; 
            
            // æ•¸æ“šè¼‰å…¥å®Œæˆå¾Œï¼Œå‰µå»º Tab ä¸¦é–‹å§‹æ¸²æŸ“
            createDayTabs();

        } catch (error) {
            console.error("Error loading data.json:", error);
            grid.innerHTML = `
                <div class="empty-state">
                    <h2>âŒ æ•¸æ“šè¼‰å…¥å¤±æ•—</h2>
                    <p>ç„¡æ³•å¾ä¼ºæœå™¨ç²å–å•†å“è³‡æ–™ã€‚è«‹ç¢ºèª data.json æª”æ¡ˆå·²å­˜åœ¨ä¸”æ ¼å¼æ­£ç¢º (æœ¬åœ°æ¸¬è©¦éœ€å•Ÿå‹•ä¼ºæœå™¨)ã€‚</p>
                </div>
            `;
        }
    }


    // --- ç›£è½äº‹ä»¶ ---
    // é é¢è¼‰å…¥æ™‚é–‹å§‹è¼‰å…¥æ•¸æ“š
    window.addEventListener('load', loadData);

    // ç¯©é¸å’Œæ’åºé‚è¼¯çš„ç›£è½å™¨
    searchInput.addEventListener('input', filterAndSort);
    categorySelect.addEventListener('change', filterAndSort);
    sortSelect.addEventListener('change', filterAndSort);
    
</script>

</body>
</html>
