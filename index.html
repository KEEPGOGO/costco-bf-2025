<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Costco é»‘è‰²æ˜ŸæœŸäº”ç‰¹åƒ¹æŸ¥è©¢</title>
    <style>
        :root {
            --primary: #005eb8; /* Costco Blue */
            --accent: #e31837; /* Costco Red */
            --bg: #f4f4f4;
            --text-color: #333;
            --discount-bg: #ffdd00; /* Yellow */
        }
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: var(--text-color);
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
        }

        /* --- æ—¥æœŸé ç±¤æ¨£å¼ --- */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            overflow-x: auto;
        }
        .tab-button {
            background-color: #fff;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .tab-button:hover {
            background-color: var(--primary);
            color: white;
        }
        .tab-button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* --- ç¯©é¸èˆ‡æ’åºå€ --- */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
        }
        .controls input[type="text"], .controls select {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        .controls label {
            font-weight: bold;
        }
        #searchInput {
            flex-grow: 1;
            min-width: 200px;
        }

        /* --- å•†å“ç¶²æ ¼èˆ‡å¡ç‰‡æ¨£å¼ --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .card h3 {
            font-size: 18px;
            margin-top: 5px;
            margin-bottom: 10px;
            color: var(--text-color);
            line-height: 1.4;
            flex-grow: 1; /* è®“åç¨±å€åŸŸæ’é–‹ï¼Œä¿æŒåƒ¹æ ¼å€åœ¨åº•éƒ¨å°é½Š */
        }
        .category-tag {
            display: inline-block;
            background-color: var(--primary);
            color: white;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 3px;
            margin-bottom: 8px;
            font-weight: normal;
        }

        /* --- åƒ¹æ ¼å€å¡Šæ¨£å¼ --- */
        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .sale-price {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
        }
        .original-price {
            font-size: 14px;
            color: #888;
            text-decoration: line-through;
        }
        .discount-tag {
            background-color: var(--discount-bg);
            color: var(--text-color);
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
        }
        .model-info {
            font-size: 12px;
            color: #aaa;
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 5px;
        }
        .note {
            font-size: 12px;
            color: #555;
            margin-top: 5px;
        }
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px 20px;
            background: #fff;
            border: 1px dashed #ccc;
            border-radius: 8px;
            margin-top: 20px;
        }
        .loading-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px 20px;
        }
        .loading-state h2::after {
            content: '...';
            display: inline-block;
            overflow: hidden;
            vertical-align: bottom;
            animation: loading-dots 1.5s infinite;
        }
        @keyframes loading-dots {
            0%, 20% { width: 0; }
            40% { width: .5em; }
            60% { width: 1em; }
            80%, 100% { width: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>2025 Costco é»‘è‰²æ˜ŸæœŸäº”ç‰¹åƒ¹æŸ¥è©¢</h1>

        <div class="tabs" id="dayTabs">
            </div>

        <div class="controls">
            <input type="text" id="searchInput" placeholder="æœå°‹å•†å“åç¨±æˆ–å•†å“ç·¨è™Ÿ (Model #)">
            
            <label for="categorySelect">åˆ†é¡:</label>
            <select id="categorySelect">
                <option value="all">æ‰€æœ‰åˆ†é¡</option>
                <option value="appliance">å®¶é›»</option>
                <option value="electronics">3C</option>
                <option value="food">é£Ÿå“</option>
                <option value="life">ç”Ÿæ´»</option>
            </select>

            <label for="sortSelect">æ’åº:</label>
            <select id="sortSelect">
                <option value="day_asc">æ—¥æœŸæ–°åˆ°èˆŠ</option>
                <option value="discount_desc">æŠ˜æ‰£é‡‘é¡é«˜åˆ°ä½</option>
                <option value="percent_desc">æŠ˜æ‰£ç™¾åˆ†æ¯”é«˜åˆ°ä½</option>
                <option value="price_asc">åƒ¹æ ¼ä½åˆ°é«˜</option>
            </select>
        </div>

        <div class="grid" id="productGrid">
            <div class="loading-state">
                <h2>æ­£åœ¨è¼‰å…¥å•†å“æ•¸æ“š</h2>
            </div>
        </div>
    </div>

    <script>
        // ğŸš¨ æ•¸æ“šåˆ†é›¢ï¼šrawData è®Šæ•¸å·²è¢«ç§»é™¤ã€‚æ•¸æ“šå°‡ç•°æ­¥è¼‰å…¥åˆ° window.allProductsData
        let currentDay = 1; // é è¨­é¡¯ç¤º Day 1
        let allProductsData = [];

        const dayTabs = document.getElementById('dayTabs');
        const searchInput = document.getElementById('searchInput');
        const categorySelect = document.getElementById('categorySelect');
        const sortSelect = document.getElementById('sortSelect');
        const grid = document.getElementById('productGrid');

        // --- æ ¸å¿ƒå‡½æ•¸ ---

        /**
         * æ¸²æŸ“å•†å“å¡ç‰‡åˆ°ç¶²æ ¼ä¸­
         * @param {Array} items - ç¶“éç¯©é¸å’Œæ’åºçš„å•†å“åˆ—è¡¨
         */
        function render(items) {
            grid.innerHTML = '';
            
            if (items.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <h2>ğŸš§ å°šç„¡è³‡æ–™</h2>
                        <p>æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„å•†å“ã€‚</p>
                    </div>
                `;
                return;
            }

            items.forEach(item => {
                // 1. åƒ¹æ ¼è¨ˆç®—
                const salePrice = item.sale ? item.sale.toLocaleString() : 'N/A';
                const originalPrice = item.original ? item.original.toLocaleString() : '';
                
                // 2. æŠ˜æ‰£é¡¯ç¤ºé‚è¼¯ (ä¿®æ­£ negative discount)
                const absoluteDiscount = Math.abs(item.discount || 0); // å–çµ•å°å€¼
                const discountDisplay = absoluteDiscount > 0 ? 
                    `çœ $${absoluteDiscount.toLocaleString()}` : 
                    "ç¾å ´ç‰¹åƒ¹";
                
                // 3. æŠ˜æ‰£ç™¾åˆ†æ¯”
                let percentDisplay = '';
                if (item.original > 0 && absoluteDiscount > 0) {
                    const percent = (absoluteDiscount / item.original) * 100;
                    percentDisplay = ` (${percent.toFixed(0)}%)`;
                }

                // 4. åœ–ç‰‡è·¯å¾‘ (é ç•™çµ¦æœªä¾†ä½¿ç”¨ï¼ŒModel ID ä½œç‚ºæª”å)
                // å‡è¨­åœ–ç‰‡å„²å­˜åœ¨ images/ è³‡æ–™å¤¾
                const imagePath = item.model ? `images/${item.model}.jpg` : 'images/placeholder.jpg';

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <img src="${imagePath}" alt="${item.name}" style="width: 100%; height: auto; border-radius: 5px; margin-bottom: 10px; background-color: #f0f0f0; border: 1px solid #ccc;">
                    
                    <span class="category-tag">${item.catName || item.category} (Day ${item.day})</span>
                    
                    <h3>${item.name}</h3>

                    <div class="price-row">
                        <span class="sale-price">$${salePrice}</span>
                        <span class="discount-tag">
                            ${discountDisplay}
                            ${percentDisplay}
                        </span>
                    </div>
                    
                    ${item.original > 0 ? `<div class="original-price">åŸåƒ¹ $${originalPrice}</div>` : ''}

                    ${item.note ? `<div class="note">ç´°é …: ${item.note}</div>` : ''}
                    
                    ${item.model ? `<div class="model-info">å•†å“ç·¨è™Ÿ: ${item.model}</div>` : ''}
                `;
                grid.appendChild(card);
            });
        }

        /**
         * åŸ·è¡Œæ‰€æœ‰ç¯©é¸å’Œæ’åºé‚è¼¯ï¼Œä¸¦å‘¼å« render
         */
        function filterAndSort() {
            if (allProductsData.length === 0) {
                render([]);
                return;
            }

            let result = [...allProductsData];

            // --- æ­¥é©Ÿ 0: Day Filter ---
            if (currentDay > 0) {
                result = result.filter(p => p.day === currentDay);
            }

            // --- æ­¥é©Ÿ 1: æœå°‹ Filter ---
            const keyword = searchInput.value.toLowerCase();
            if (keyword) {
                result = result.filter(p => 
                    p.name.toLowerCase().includes(keyword) || 
                    (p.model && p.model.toLowerCase().includes(keyword))
                );
            }

            // --- æ­¥é©Ÿ 2: åˆ†é¡ Filter ---
            const cat = categorySelect.value;
            if (cat !== 'all') {
                result = result.filter(p => p.category === cat);
            }

            // --- æ­¥é©Ÿ 3: æ’åº Sort ---
            const sortType = sortSelect.value;
            if (sortType === 'discount_desc') {
                // æ’åºæ™‚ä¹Ÿä½¿ç”¨çµ•å°å€¼
                result.sort((a, b) => Math.abs(b.discount || 0) - Math.abs(a.discount || 0));
            } else if (sortType === 'price_asc') {
                result.sort((a, b) => {
                    // å°‡æ²’æœ‰ sale åƒ¹çš„æ’åœ¨å¾Œé¢
                    if(a.sale === 0) return 1;
                    return a.sale - b.sale;
                });
            } else if (sortType === 'percent_desc') {
                result.sort((a, b) => {
                    const discA = Math.abs(a.discount || 0);
                    const discB = Math.abs(b.discount || 0);

                    const perA = a.original > 0 ? (discA / a.original) : 0;
                    const perB = b.original > 0 ? (discB / b.original) : 0;
                    return perB - perA;
                });
            } else if (sortType === 'day_asc') {
                 result.sort((a, b) => b.day - a.day); // æ—¥æœŸæ–°åˆ°èˆŠ
            }


            render(result);
        }

        /**
         * è¨­ç½®ç•¶å‰é¡¯ç¤ºçš„å¤©æ•¸ï¼Œä¸¦è§¸ç™¼ç¯©é¸
         * @param {number} day - è¦é¡¯ç¤ºçš„å¤©æ•¸
         */
        function setDay(day) {
            currentDay = day;
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.getElementById(`day-tab-${day}`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            filterAndSort();
        }

        /**
         * å‹•æ…‹å‰µå»º Day Tabs (ç‚ºäº†ç¢ºä¿èƒ½é¡¯ç¤º Day 1, Day 2, Day 3...)
         */
        function createDayTabs() {
            // æ‰¾å‡ºæ•¸æ“šä¸­æœ€å¤§çš„å¤©æ•¸
            const maxDay = allProductsData.reduce((max, p) => Math.max(max, p.day), 0);
            dayTabs.innerHTML = '';
            for (let i = 1; i <= maxDay; i++) {
                const button = document.createElement('button');
                button.className = 'tab-button';
                button.id = `day-tab-${i}`;
                button.textContent = `Day ${i}`;
                button.onclick = () => setDay(i);
                dayTabs.appendChild(button);
            }
            // é è¨­é¸ä¸­ Day 1
            if (maxDay >= 1) {
                setDay(1);
            } else {
                render([]); // å¦‚æœæ²’æœ‰æ•¸æ“šï¼Œé¡¯ç¤ºç©ºç‹€æ…‹
            }
        }
        
        /**
         * ç•°æ­¥è¼‰å…¥æ•¸æ“š (é—œéµä¿®æ­£)
         */
        async function loadData() {
            grid.innerHTML = `<div class="loading-state"><h2>æ­£åœ¨è¼‰å…¥å•†å“æ•¸æ“š</h2></div>`;

            try {
                const response = await fetch('data.json'); 
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const rawData = await response.json();
                
                // å°‡è¼‰å…¥çš„æ•¸æ“šè³¦äºˆå…¨åŸŸè®Šæ•¸
                allProductsData = rawData; 
                
                // æ•¸æ“šè¼‰å…¥å®Œæˆå¾Œï¼Œå‰µå»º Tab ä¸¦é–‹å§‹æ¸²æŸ“
                createDayTabs();

            } catch (error) {
                console.error("Error loading data.json:", error);
                grid.innerHTML = `
                    <div class="empty-state">
                        <h2>âŒ æ•¸æ“šè¼‰å…¥å¤±æ•—</h2>
                        <p>ç„¡æ³•å¾ä¼ºæœå™¨ç²å–å•†å“è³‡æ–™ã€‚è«‹ç¢ºèª data.json æª”æ¡ˆå·²å­˜åœ¨ã€‚</p>
                    </div>
                `;
            }
        }


        // --- ç›£è½äº‹ä»¶ ---
        // é é¢è¼‰å…¥æ™‚é–‹å§‹è¼‰å…¥æ•¸æ“š
        window.addEventListener('load', loadData);

        // ç¯©é¸å’Œæ’åºé‚è¼¯çš„ç›£è½å™¨
        searchInput.addEventListener('input', filterAndSort);
        categorySelect.addEventListener('change', filterAndSort);
        sortSelect.addEventListener('change', filterAndSort);
        
    </script>
</body>
</html>
